# 远控木马攻击溯源报告

**目标IP**: 52.168.117.170  
**分析时间**: 2025-12-11 02:36:30  
**分析师**: Cybereye-Agent  
**威胁等级**: 高

---

## 执行摘要

本次溯源调查针对主机受到IP地址 `52.168.117.170` 攻击的事件。通过系统化的应急响应流程，发现以下关键信息：

1. **威胁情报确认**: IP地址 `52.168.117.170` 被微步在线标记为恶意IP，关联Redirector木马和Ramnit病毒家族
2. **本地连接发现**: 发现OneDrive进程 (PID: 15992) 正在尝试连接到该恶意IP的443端口
3. **文件分析**: OneDrive.exe文件具有有效的微软签名，但连接行为异常
4. **持久化机制**: 发现正常的OneDrive自启动配置，未发现明显的恶意持久化机制
5. **账户安全**: 本地用户账户正常，未发现可疑账户

## 详细分析

### 1. 威胁情报分析

**数据来源**: 微步在线威胁情报平台  
**查询时间**: 2025-12-11 02:28:55

#### 关键发现：
- **IP威胁等级**: 高
- **关联恶意样本**: 7个，其中3个被标记为恶意
  - Redirector木马 (HTML Document) - 最新检测: 2025-12-09
  - Ramnit病毒 (DLLx86) - 检测时间: 2025-04-12
  - Ramnit病毒 (EXEx86) - 检测时间: 2024-08-14
- **攻击者可能意图**:
  - 通过HTML重定向木马进行钓鱼攻击
  - 使用Ramnit病毒建立后门连接和数据窃取
  - 横向移动和持久化控制

#### 释放路径分析：
恶意文件常被释放到以下位置进行伪装：
- `C:\Program Files (x86)\Microsoft\` (伪装成微软官方文件)
- `C:\Users\*\AppData\Local\Microsoft\` (利用微软目录隐藏)
- `C:\Users\*\AppData\Local\Google\` (伪装成谷歌软件)

### 2. 杀毒软件查杀检测

**工具**: hrkill杀毒软件  
**结果**: 查杀完成，耗时15秒  
**状态**: 未发现明显的病毒告警（需要进一步检查查杀日志）

### 3. 流量检测分析

#### 3.1 netstat命令检测
```
TCP    10.12.190.92:51989     52.168.117.170:443     SYN_SENT        15992
```

#### 3.2 PowerShell精准定位
```
LocalAddress    LocalPort RemoteAddress    RemotePort State       AppliedSetting
------------    --------- -------------    ---------- -----       --------------
10.12.190.92    51989     52.168.117.170   443        SynSent     Internet
```

**关键发现**:
- 本地进程正在尝试建立到恶意IP `52.168.117.170:443` 的HTTPS连接
- 连接状态为 `SynSent`，表示连接尝试正在进行中
- 关联进程PID: 15992

### 4. 恶意进程分析

#### 4.1 进程详细信息
```
进程PID: 15992 详细信息
进程名 (Name): OneDrive
可执行文件路径 (ExecutablePath): C:\Program Files\Microsoft OneDrive\OneDrive.exe
命令行参数 (CommandLine): "C:\Program Files\Microsoft OneDrive\OneDrive.exe" /background
进程启动时间 (StartTime): 12/10/2025 21:15:39
```

#### 4.2 文件签名验证
- **签名状态**: Valid (有效)
- **签发者**: Microsoft Corporation
- **时间戳**: Microsoft Time-Stamp Service
- **结论**: 文件具有合法的微软数字签名

#### 4.3 文件时间戳分析
```
创建时间: 2024/12/27 18:43:07
最后修改时间: 2025/12/9 19:25:19
最后访问时间: 2025/12/11 2:34:39
进程启动时间: 2025/12/10 21:15:39
```

**时间线分析**:
1. 文件在2025年12月9日被修改（进程启动前1天）
2. 进程在2025年12月10日21:15:39启动
3. 这可能表示正常的OneDrive更新，但也可能是恶意修改

#### 4.4 文件哈希计算
```
算法: SHA256
哈希值: 4511F2E74347FB2D1153A8AE8DE51CB3938F5609247CDA6030C0F7E4BFFD0711
文件路径: C:\Program Files\Microsoft OneDrive\OneDrive.exe
```

#### 4.5 文件元数据
```
产品名称: Microsoft OneDrive
文件描述: Microsoft OneDrive
公司名称: Microsoft Corporation
文件版本: 25.216.1104.0002
```

### 5. 持久化机制排查

#### 5.1 注册表启动项
- **发现**: OneDrive在注册表启动项中正常配置
- **路径**: `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
- **命令**: `"C:\Program Files\Microsoft OneDrive\OneDrive.exe" /background`

#### 5.2 计划任务
发现以下OneDrive相关计划任务（均为正常配置）：
- OneDrive Per-Machine Standalone Update Task
- OneDrive Reporting Task
- OneDrive Startup Task

#### 5.3 系统服务
未发现与OneDrive直接相关的可疑服务。发现的非系统服务包括：
- 火绒企业安全终端服务 (Huorong)
- Everything搜索服务
- 腾讯QQ保护服务
- VMware相关服务
- 其他第三方软件服务

### 6. 账户与日志安全分析

#### 6.1 本地用户账户
```
本地用户列表:
- Administrator (禁用)
- DefaultAccount (禁用)
- Guest (禁用)
- User (启用，最后登录: 2025/12/10 21:15:09)
- WDAGUtilityAccount (禁用)

管理员组成员:
- DESKTOP-TVP7N18\Administrator
- DESKTOP-TVP7N18\User
```

**结论**: 未发现可疑账户，所有账户状态正常。

#### 6.2 安全事件日志
- 未找到与进程PID 15992相关的进程创建事件 (Event ID 4688)
- 这可能是因为安全日志配置或事件未被记录

## 综合分析结论

### 风险评估

1. **高风险指标**:
   - 合法的OneDrive进程正在连接已知的恶意IP地址
   - 连接目标端口为443 (HTTPS)，可能用于加密通信逃避检测
   - 威胁情报确认该IP关联多种恶意软件

2. **中风险指标**:
   - OneDrive文件具有有效的微软签名，降低了文件本身是恶意软件的可能性
   - 未发现明显的持久化机制异常
   - 账户安全状态正常

3. **可能性分析**:
   - **可能性最高**: OneDrive进程被DLL注入或进程 Hollowing技术利用
   - **可能性中等**: 系统中有恶意软件通过OneDrive进行通信或伪装
   - **可能性较低**: 正常的OneDrive连接误报（但威胁情报数据支持恶意性）

### 攻击链重建假设

基于现有证据，可能的攻击链如下：

1. **初始入侵**: 通过钓鱼邮件或恶意网站下载Redirector木马
2. **载荷投放**: Redirector木马下载Ramnit病毒或其他恶意载荷
3. **进程注入**: 恶意代码注入到合法的OneDrive进程中
4. **C2通信**: 通过OneDrive进程与C2服务器 (`52.168.117.170:443`) 通信
5. **数据窃取**: 可能通过加密通道窃取用户数据

## 应急响应建议

### 立即行动项

1. **网络隔离**:
   - 在防火墙/IPS上立即阻断与 `52.168.117.170` 的所有通信
   - 监控其他异常出站连接

2. **进程处置**:
   - 终止PID 15992进程: `taskkill /PID 15992 /F`
   - 暂时禁用OneDrive自启动

3. **深度检测**:
   - 使用内存分析工具检查OneDrive进程是否被注入
   - 使用进程监控工具 (如ProcMon) 监控OneDrive行为
   - 检查系统中是否存在报告中提到的恶意文件哈希

### 调查方向

1. **内存取证**: 对OneDrive进程进行内存转储分析
2. **网络流量分析**: 捕获并分析与恶意IP的通信内容
3. **系统完整性检查**: 使用系统文件检查器 (SFC) 验证系统文件完整性
4. **全盘扫描**: 使用多种杀毒引擎进行深度扫描

### 防护加固

1. **应用程序控制**: 启用应用程序白名单策略
2. **网络监控**: 加强出站连接监控，特别是到非常用端口的连接
3. **用户教育**: 加强网络安全意识培训，防范钓鱼攻击
4. **系统更新**: 确保所有系统和应用程序补丁及时更新

## 后续工作

1. **高优先级**:
   - 验证OneDrive文件哈希是否与官方版本一致
   - 检查系统中是否存在威胁情报报告中提到的释放文件

2. **中优先级**:
   - 分析网络流量日志，确认是否有数据外泄
   - 检查其他进程是否有类似的异常连接

3. **低优先级**:
   - 调查相关域名的注册信息和历史记录
   - 建立该威胁指标的监控规则

## 附录

### 相关文件
1. 威胁情报报告: `./logs/ioc/52.168.117.170_ip_threat_report.md`
2. 威胁数据CSV: `./logs/ioc/52.168.117.170_threat_data.csv`
3. hrkill查杀截图: `D:\MCPSecTrace\src\mcpsectrace\mcp_servers\artifacts\hrkill\scan_progress.png`

### 使用的工具和命令
1. IOC分析: ioc MCP服务器 `analyze_ip_threat` 工具
2. 病毒查杀: hrkill MCP服务器 `scan_virus` 工具
3. 流量检测: `netstat -ano`, `Get-NetTCPConnection`
4. 进程分析: `Get-Process`, `Get-CimInstance`
5. 文件分析: `Get-FileHash`, `Get-AuthenticodeSignature`
6. 持久化检查: 注册表、计划任务、服务查询

---
*报告生成时间: 2025-12-11 02:36:30*  
*分析师: Cybereye-Agent*  
*注意: 本报告基于自动化分析工具结果，实际响应需结合人工验证和进一步调查。*
